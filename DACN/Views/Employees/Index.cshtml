@model IEnumerable<Models.Employee>
@{
    ViewBag.Title = "Danh s√°ch nh√¢n vi√™n";
}

<!-- Success/Warning/Error Messages -->
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
@if (TempData["WarningMessage"] != null)
{
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill"></i> @TempData["WarningMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
@if (ViewBag.ErrorMessage != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-x-circle-fill"></i> @ViewBag.ErrorMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Page Header -->
<div class="row mb-4 slide-in-up">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="display-6 fw-bold mb-0">
                    <i class="bi bi-people-fill text-primary"></i> Qu·∫£n l√Ω Nh√¢n vi√™n
                </h1>
                <p class="text-muted mb-0">Qu·∫£n l√Ω th√¥ng tin nh√¢n vi√™n v√† khu√¥n m·∫∑t</p>
            </div>
            <a href="/Employees/Create" class="btn btn-success btn-lg">
                <i class="bi bi-plus-circle"></i> Th√™m nh√¢n vi√™n m·ªõi
            </a>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4 g-3">
    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="text-primary">@Model.Count()</h3>
                    <p>T·ªïng nh√¢n vi√™n</p>
                </div>
                <i class="bi bi-people icon text-primary"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="text-success">@Model.Count(e => e.FaceEmbedding != null)</h3>
                    <p>ƒê√£ c√≥ Face ID</p>
                </div>
                <i class="bi bi-person-check icon text-success"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="text-warning">@Model.Count(e => e.FaceEmbedding == null)</h3>
                    <p>Ch∆∞a c√≥ Face ID</p>
                </div>
                <i class="bi bi-person-x icon text-warning"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="text-danger">@Model.Count(e => e.IsLocked)</h3>
                    <p>ƒêang b·ªã kh√≥a</p>
                </div>
                <i class="bi bi-lock icon text-danger"></i>
            </div>
        </div>
    </div>
</div>

<!-- Employees Table -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h5 class="mb-0 text-white">
                    <i class="bi bi-table"></i> Danh s√°ch nh√¢n vi√™n
                </h5>
            </div>
            <div class="card-body">
                <!-- Search and Filter -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <input type="text" id="searchInput" class="form-control" placeholder="üîç T√¨m ki·∫øm nh√¢n vi√™n...">
                    </div>
                    <div class="col-md-3">
                        <select id="departmentFilter" class="form-select">
                            <option value="">T·∫•t c·∫£ ph√≤ng ban</option>
                            @foreach (var dept in Model.Select(e => e.Department).Distinct())
                            {
                                <option value="@dept">@dept</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select id="statusFilter" class="form-select">
                            <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                            <option value="locked">B·ªã kh√≥a</option>
                        </select>
                    </div>
                </div>

                <!-- Table -->
                <div class="table-responsive">
                    <table class="table table-hover align-middle" id="employeeTable">
                        <thead>
                            <tr>
                                <th style="width: 60px;"><i class="bi bi-hash"></i> ID</th>
                                <th><i class="bi bi-person"></i> T√™n</th>
                                <th><i class="bi bi-building"></i> Ph√≤ng ban</th>
                                <th><i class="bi bi-envelope"></i> Email</th>
                                <th><i class="bi bi-telephone"></i> ƒêi·ªán tho·∫°i</th>
                                <th style="width: 120px;"><i class="bi bi-person-bounding-box"></i> Face ID</th>
                                <th style="width: 100px;"><i class="bi bi-shield-check"></i> Tr·∫°ng th√°i</th>
                                <th style="width: 200px;" class="text-center"><i class="bi bi-gear"></i> Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var emp in Model)
                            {
                                <tr data-department="@emp.Department" data-status="@(emp.IsLocked ? "locked" : "active")">
                                    <td><strong>#@emp.Id</strong></td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle bg-primary text-white me-2">
                                                @emp.Name?.Substring(0, 1)
                                            </div>
                                            <strong>@emp.Name</strong>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">@emp.Department</span>
                                    </td>
                                    <td>@emp.Email</td>
                                    <td>@emp.Phone</td>
                                    <td>
                                        @if (emp.FaceEmbedding != null)
                                        {
                                            <span class="badge bg-success">
                                                <i class="bi bi-check-circle"></i> C√≥
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-warning">
                                                <i class="bi bi-x-circle"></i> Ch∆∞a
                                            </span>
                                        }
                                    </td>
                                    <td>
                                        @if (emp.IsLocked)
                                        {
                                            <span class="badge bg-danger">
                                                <i class="bi bi-lock"></i> Kh√≥a
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">
                                                <i class="bi bi-unlock"></i> Ho·∫°t ƒë·ªông
                                            </span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group btn-group-sm" role="group">
                                            <a href="/Employees/Details/@emp.Id" class="btn btn-info" title="Xem chi ti·∫øt">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                            <a href="/Employees/Edit/@emp.Id" class="btn btn-warning" title="Ch·ªânh s·ª≠a">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                            <a href="/Employees/Delete/@emp.Id" class="btn btn-danger" title="X√≥a">
                                                <i class="bi bi-trash"></i>
                                            </a>
                                            @if (emp.IsLocked)
                                            {
                                                <a href="/Employees/Unlock/@emp.Id" class="btn btn-secondary" title="M·ªü kh√≥a">
                                                    <i class="bi bi-unlock"></i>
                                                </a>
                                            }
                                            else
                                            {
                                                <a href="/Employees/Lock/@emp.Id" class="btn btn-dark" title="Kh√≥a">
                                                    <i class="bi bi-lock"></i>
                                                </a>
                                            }
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS for Avatar -->
<style>
    .avatar-circle {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1rem;
    }
</style>

<!-- Search and Filter Script -->
@section Scripts {
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const departmentFilter = document.getElementById('departmentFilter');
        const statusFilter = document.getElementById('statusFilter');
        const table = document.getElementById('employeeTable');
        const rows = table.querySelectorAll('tbody tr');

        function filterTable() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedDept = departmentFilter.value;
            const selectedStatus = statusFilter.value;

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const dept = row.getAttribute('data-department');
                const status = row.getAttribute('data-status');

                const matchSearch = text.includes(searchTerm);
                const matchDept = !selectedDept || dept === selectedDept;
                const matchStatus = !selectedStatus || status === selectedStatus;

                if (matchSearch && matchDept && matchStatus) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        searchInput.addEventListener('keyup', filterTable);
        departmentFilter.addEventListener('change', filterTable);
        statusFilter.addEventListener('change', filterTable);
    });
</script>
}
